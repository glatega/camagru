<html>
	<body>
		<style>
		video, canvas { max-width: 100%; height: auto; }
		</style>
		<canvas id="canvas"></canvas><br>
		<button id="snap">Take Picture</button><br>
		<button id="cancel">Cancel</button><br>
		<table>
			<tr>
				<td>Blur</td>
				<td><input min="0" max="20" value="0" step="1" oninput="applyFilter()" data-filter="blur" data-scale="px" type="range"></td>
			</tr>
			<tr>
				<td>Brightness</td>
				<td><input min="0" max="200" value="100" step="1" oninput="applyFilter()" data-filter="brightness" data-scale="%" type="range"></td>
			</tr>
			<tr>
				<td>Contrast</td>
				<td><input min="0" max="200" value="100" step="1" oninput="applyFilter()" data-filter="contrast" data-scale="%" type="range"></td>
			</tr>
			<tr>
				<td>Grayscale?</td>
				<td><input min="0" max="100" value="0" step="1" oninput="applyFilter()" data-filter="grayscale" data-scale="%" type="range"></td>
			</tr>
			<tr>
				<td>Hue Rotate</td>
				<td><input min="0" max="360" value="0" step="1" oninput="applyFilter()" data-filter="hue-rotate" data-scale="deg" type="range"></td>
			</tr>
			<tr>
				<td>Invert</td>
				<td><input min="0" max="100" value="0" step="1" oninput="applyFilter()" data-filter="invert" data-scale="%" type="range"></td>
			</tr>
			<tr>
				<td>Opacity</td>
				<td><input min="0" max="100" value="100" step="1" oninput="applyFilter()" data-filter="opacity" data-scale="%" type="range"></td>
			</tr>
			<tr>
				<td>Saturate</td>
				<td><input min="1" max="100" value="100" step="1" oninput="applyFilter()" data-filter="saturate" data-scale="%" type="range"></td>
			</tr>
			<tr>
				<td>Sepia</td>
				<td><input min="0" max="100" value="0" step="1" oninput="applyFilter()" data-filter="sepia" data-scale="%" type="range"></td>
			</tr>
		
		</table>

		<script>
			
		canvas = document.getElementById('canvas');

		var filterControls = document.querySelectorAll('input[type=range]');
		function applyFilter() {
			var computedFilters = '';
			filterControls.forEach(function(item, index) {
				computedFilters += item.getAttribute('data-filter') + '(' + item.value + item.getAttribute('data-scale') + ') ';
			});
			canvas.style.filter = computedFilters;
		};

		window.onload = function() {

			navigator.getUserMedia  = navigator.getUserMedia ||
									navigator.webkitGetUserMedia ||
									navigator.mozGetUserMedia ||
									navigator.msGetUserMedia;

			
			video = document.createElement('video');
			video.setAttribute('autoplay',true);
			
			ctx = canvas.getContext('2d');
			
			window.vid = video;
			
			function getWebcam() {
				navigator.getUserMedia({ video: true, audio: false }, function(stream) {
					video.srcObject = stream;
					track = stream.getTracks()[0];
				}, function(e) {
					console.error('Rejected!', e);
				});
			}
			
			getWebcam();
			
			var loopFrame;
			
			function loop() {
				ctx.save();
				ctx.restore();
				
				ctx.globalAlpha = 0.1;
				ctx.drawImage(video, 0, 0, width, height);
				
				loopFrame = requestAnimationFrame(loop);
			}
			
			function startLoop() {
				ctx.translate(width, 0);
				ctx.scale(-1, 1);
				loopFrame = loopFrame || requestAnimationFrame(loop);
			}
			
			video.addEventListener('loadedmetadata',function(){
				width = canvas.width = video.videoWidth;
				height = canvas.height = video.videoHeight;
				startLoop();
			});
			
			document.querySelector('#snap').onclick = function() {
				cancelAnimationFrame(loopFrame);
			}

			document.querySelector('#cancel').onclick = function() {
				loopFrame = requestAnimationFrame(loop);
			}

		}

		window.onunload = function() {}
		</script>
	</body>
</html>
